<!DOCTYPE html>
<html>
  <head>
    <title>Wild Closures with JS</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/styles.css" media="screen" />
    <script>
      var crimes = [
      'Stabbing', 'Shooting', 'Banana Theft', 'Gazelle Feeding', 'Car Racing', 'Stripping', 'Playing Classical Guitar', 'Oversleeping'
      ];
      var locations = [
      'The Old Mill', 'The Zoo', 'Waterfront', 'City Center', 'The Badlands', 'Highway 1'
      ];
    </script>
  </head>
  
  <body>
    <div id="wrapper" class="clearfix">
      <div class="inner_wrapper">
        
        <div class="header">
          <h1>Wild Closures!</h1>
        </div><!-- end header //-->
      
        <div class="left col one_third">
          <h2>Choose a crime:</h2>
          <select name="crime_select" id="crime_selector">
            <option value="---">choose a crime</option>
            <script>
              for(var i=0, max=crimes.length; i<max; i++){
                document.writeln('<option value="' + crimes[i] + '">' + crimes[i] + '</option>');
              }
            </script>
          </select>
          <br />
          <br />
          <select name="location_select" id="location_selector">
            <option value="---">choose the location where it happened:</option>
            <script>
              for(var i=0, max=locations.length; i<max; i++){
                document.writeln('<option value="' + locations[i] + '">' + locations[i] + '</option>');
              }
            </script>
          </select>

          <p class="instructions" data-subject="instructions">Great, now plot it on the map ></p>
        </div><!-- end left col //-->

        <div class="right col two_thirds">
          <div id="crime_map">
          </div>
        </div><!-- end right col //-->
      </div><!-- end inner wrapper //-->
    </div><!-- end wrapper //-->
    <div class="footer">Footer</div>
    
  </body>
  <script>
  var el = document.getElementById('crime_map'),
      popper = buildPopup,
      instructionEl = document.getElementsByClassName('instructions'),
      crime = document.getElementById('crime_selector'),
      times = ['am', 'pm'],
      loc = document.getElementById('location_selector');
      //default vals for select menus - reset on pageload
      crime.value = "---";
      loc.value = "---";
  
    //our wild closure...
    function crimeReport( crime ){
      var counter = 0,
          arr = [],
          report = '',
          msg = '';
      return function(number, location, time){
        //var el = document.getElementById('crime_map');
        msg += "Alert! There has been an incident!\n" +
              number + " " + crime + "(s) happened around " +
              time + ", at " + location;
        // alert(msg);
      } 
    }
    
    function buildPopup(e, msg) {
      console.log(document.body.firstChild[0] + e.target.id);
      var modal = document.createElement('div');
      modal.setAttribute('class', 'crime_modal');
      
      var tip = document.createElement('div');
      tip.setAttribute('class', 'pointer');
      
      var left_col = document.createElement('div');
      left_col.setAttribute('class', 'col');
      
      var modal_img = document.createElement('img');
      modal_img.setAttribute('src', '');
      modal_img.setAttribute('class', 'crime_icon');
      
      var right_col = document.createElement('div');
      right_col.setAttribute('class', 'col');
      
      var closer = document.createElement('div');
      closer.setAttribute('class', 'close_button');
      
      var closer_text = document.createElement('span');
      closer_text.innerHTML='close';
      
      var text = document.createElement('p');
      text.innerHTML=msg;
      
      left_col.appendChild(modal_img);
      right_col.appendChild(closer_text);
      right_col.appendChild(text);
      right_col.appendChild(tip);
      modal.appendChild(left_col);
      modal.appendChild(right_col);
      
      e.target.appendChild(modal);
      // var html = '<div class="crime_modal">';
      // html += '<div class="col"><img src="" class="crime_icon" />';
      // html += '</div></div>';
      // html += '<div class="col">';
      // html += '<div class="close_button">close</div><p>' + msg + '</p>';
      // html += '</div></div>';
      // return html;
    }

    crime.addEventListener('change', function(e){
      if(this.value != "---"){
        loc.style.display = "block";
      }
    });
    loc.addEventListener('change', function(){
      if(this.value != "---"){
        report = crimeReport(crime.value);
        console.log(instructionEl[0]);
        instructionEl[0].style.display = "block";
      }
    });
    el.addEventListener('click', function(e){ 
      var xpos = e.pageX - el.offsetLeft;
      var ypos = e.pageY - el.offsetTop;
      el.appendChild(buildPopup(e, 'heh'));
      console.log('click\nx:' + xpos + "\ny: " + ypos + '\n' + popper); 
      });
    el.addEventListener('click', function(e){
      if(report) {
        var num = Math.floor((Math.random() * 78)+1),
            hr = Math.floor((Math.random() * 11)+1),
            ampm = times[Math.floor((Math.random() * 1)+1)];
        console.log("num: " + num + "\nhr: " + hr + "\nampm: " + ampm);
        report(num, hr + ampm, loc.value);
        num = hr = ampm = null;
        console.log("num: " + num + "\nhr: " + hr + "\nampm: " + ampm);
      }
    });
      /*
    el.addEventListener('click', '.close_button', function(e){
      el.removeElement(this);
    });
    */
  </script>
</html>